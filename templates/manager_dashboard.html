{% extends "base.html" %}
{% block title %} | لوحة المدير{% endblock %}
{% block content %}
<h2 class="text-brand">لوحة تحكم المدير</h2>
<div class="stats-row" style="display:flex;gap:24px;margin-bottom:32px;">
    <div class="stat-card">
        <div class="stat-title">عدد العقود الكلية</div>
        <div class="stat-value">{{ stats.total_contracts }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-title">العقود الجديدة هذا الشهر</div>
        <div class="stat-value">{{ stats.new_this_month }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-title">العقود المعلقة</div>
        <div class="stat-value">{{ stats.pending_contracts }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-title">العقود المنتهية/المجددة</div>
        <div class="stat-value">{{ stats.closed_contracts }}</div>
    </div>
</div>
<hr>
<h3>قائمة العقود</h3>
<form method="get" class="filter-row" style="margin-bottom:18px;">
    <input type="text" name="q" placeholder="بحث بالاسم أو رقم العقد" value="{{ q }}">
    <select name="status">
        <option value="">كل الحالات</option>
        <option value="pending" {% if status=='pending' %}selected{% endif %}>معلقة</option>
        <option value="signed" {% if status=='signed' %}selected{% endif %}>موقعة</option>
        <option value="closed" {% if status=='closed' %}selected{% endif %}>منتهية/مرفوضة</option>
    </select>
    <button type="submit" class="btn btn-primary">بحث</button>
</form>
<table class="contracts-table">
    <thead>
        <tr>
            <th>رقم العقد</th>
            <th>الموظف</th>
            <th>العميل</th>
            <th>الحالة</th>
            <th>تاريخ الإنشاء</th>
            <th>إجراءات</th>
        </tr>
    </thead>
    <tbody>
        {% for c in items %}
        <tr>
            <td>{{ c.serial }}</td>
            <td>{{ c.created_by_name }}</td>
            <td>{{ c.client_name }}</td>
            <td>{{ c.status_display }}</td>
            <td>{{ c.created_at|strftime('%Y-%m-%d') }}</td>
            <td>
                <a href="{{ url_for('contracts_detail', cid=c.id) }}" class="btn btn-sm btn-outline-primary">عرض</a>
                {% if c.status == 'pending' %}
                    <form method="post" action="{{ url_for('manager_approve_contract', cid=c.id) }}" style="display:inline;">
                        <button type="submit" class="btn btn-sm btn-success">اعتماد</button>
                    </form>
                    <form method="post" action="{{ url_for('manager_reject_contract', cid=c.id) }}" style="display:inline;">
                        <button type="submit" class="btn btn-sm btn-danger">رفض</button>
                    </form>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<hr>
<h3>نشاط الموظفين</h3>
<table class="contracts-table">
    <thead>
        <tr>
            <th>اسم الموظف</th>
            <th>عدد العقود</th>
            <th>آخر نشاط</th>
        </tr>
    </thead>
    <tbody>
        {% for emp in employees %}
        <tr>
            <td>{{ emp.name }}</td>
            <td>{{ emp.contract_count }}</td>
            <td>{{ emp.last_activity }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
{% block extra_head %}<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">{% endblock %}