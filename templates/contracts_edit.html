{% extends "base.html" %}
{% block title %}تعديل العقد{% endblock %}
{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/contracts_modern.css') }}">
{% endblock %}
{% block content %}
<div class="dashboard-layout">
  <div class="sidebar">
    <a href="{{ url_for('dashboard') }}" class="icon active" title="الرئيسية">🏠</a>
    <a href="{{ url_for('contracts_list') }}" class="icon" title="العقود">📄</a>
    <a href="{{ url_for('contracts_in_progress') }}" class="icon" title="تحت الإجراء">⏳</a>
    <a href="{{ url_for('contracts_closed') }}" class="icon" title="مغلقة">❌</a>
    <a href="{{ url_for('notifications') }}" class="icon" title="الإشعارات">🔔</a>
    <a href="{{ url_for('profile') }}" class="icon" title="الملف الشخصي">👤</a>
    <a href="{{ url_for('logout') }}" class="icon" title="خروج">🚪</a>
  </div>
  <div class="dashboard-main">
    <div class="modern-header" style="display:flex;justify-content:flex-start;align-items:center;gap:12px;">
      {% from '_macros.html' import back_button %}{{ back_button() }}
      <h3 style="margin:0;color:var(--sama-primary)">تعديل العقد</h3>
    </div>
  {# body class controlled centrally in base.html via auth_page #}

    <div class="container">
      <div class="card p-3" style="display:flex;gap:20px;align-items:flex-start;flex-direction:column;">
        <!-- top: account header (matches mockup spacing) -->
        <div style="display:flex;align-items:center;justify-content:space-between;width:100%">
          <div style="display:flex;align-items:center;gap:12px">
            <div style="width:64px;height:64px;border-radius:50%;background:#f3f4f6;display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--sama-primary)">ع</div>
            <div>
              <div style="font-weight:700">{{ item.title or 'العقد' }}</div>
              <div style="color:var(--sama-muted);font-size:13px">تعديل بيانات العقد</div>
            </div>
          </div>
          <div style="display:flex;gap:10px">
            <a class="btn btn-light" href="{{ url_for('contracts_list') }}">إلغاء</a>
            <button form="main-form" class="btn btn-primary" name="action" value="save">حفظ</button>
          </div>
        </div>
        <form id="main-form" method="POST" class="" style="width:100%">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <div class="mb-3">
            <label class="form-label">العنوان</label>
            <input name="title" class="form-control" required value="{{ item.title|default('') }}">
          </div>
          <div class="mb-3">
            <label class="form-label">نص العقد</label>
            <textarea name="content" class="form-control" rows="12" required>{{ item.content|default('') }}</textarea>
          </div>
          <div class="row g-2">
            <div class="col-md-4">
              <label class="form-label">العميل</label>
              <input name="client_name" class="form-control" value="{{ item.client_name|default('') }}">
            </div>
            <div class="col-md-4">
              <label class="form-label">الهوية/السجل</label>
              <input name="client_id_number" class="form-control" value="{{ item.client_id_number|default('') }}">
            </div>
            <div class="col-md-4">
              <label class="form-label">الجوال</label>
              <input name="client_phone" class="form-control" value="{{ item.client_phone|default('') }}">
            </div>
            <div class="col-md-6">
              <label class="form-label">العنوان</label>
              <input name="client_address" class="form-control" value="{{ item.client_address|default('') }}">
            </div>
            <div class="col-md-6">
              <label class="form-label">مبلغ المشاركة</label>
              <input name="investment_amount" class="form-control" value="{{ item.investment_amount|default('') }}" inputmode="decimal" placeholder="مثال: 250000">
              {% if item.investment_amount %}
                <div class="form-text" style="display:flex;align-items:center;gap:6px;margin-top:4px;">
                  <span>
                    {% set amount = item.investment_amount|default('0') %}
                    {{ "{:,.2f}".format(amount|float) }}
                  </span>
                  <img src="{{ url_for('static', filename='img/Saudi_Riyal_Symbol.svg.png') }}" 
                    alt="SAR" style="height:18px;vertical-align:middle;margin-right:4px;">
                </div>
              {% endif %}
            </div>
          </div>
          <div class="btn-row">
            <button class="btn btn-secondary" name="action" value="preview" type="submit">👁 معاينة</button>
            <button class="btn btn-primary"   name="action" value="save"    type="submit">حفظ</button>
            <button class="btn btn-outline-primary" name="action" value="save_back" type="submit">حفظ والرجوع</button>
            <button class="btn btn-success"   name="action" value="save_pdf" type="submit">حفظ + PDF</button>
            <a class="btn btn-light" href="{{ url_for('contracts_list') }}">إلغاء</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}